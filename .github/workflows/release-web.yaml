# Web Release Workflow
#
# This workflow is called by the main release orchestrator to deploy web application.
# It downloads pre-built web artifacts and deploys to the production environment.
#
# Role in release workflow:
# - Called by main release.yaml orchestrator
# - Receives version from semantic-release
# - Downloads pre-built web artifacts
# - Deploys web app to production

name: Release Web

on:
  workflow_call:
    inputs:
      version:
        description: 'Release version'
        required: true
        type: string
    secrets:
      CLOUDFLARE_API_TOKEN:
        required: true
      CLOUDFLARE_ACCOUNT_ID:
        required: true

concurrency: deploy-to-production

jobs:
  deploy-to-production:
    name: Deploy Website to Production
    runs-on: ubuntu-latest
    environment: Production
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Download app build artifacts
        uses: actions/download-artifact@v4
        with:
          name: app-build
          path: artifacts/website

      - name: Deploy to Cloudflare Pages
        if: github.ref_name == 'release'
        run: |
          npx wrangler@latest pages deploy artifacts/website --project-name=algokit-lora --commit-dirty=true --branch=release
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
